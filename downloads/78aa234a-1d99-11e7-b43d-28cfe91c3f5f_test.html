<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		canvas.range-control {
			position: absolute;
			cursor: pointer;
		/* 	background: blue; */
		}

		div.range-hold {
			box-shadow: 0px 0px 6px 4px gray inset;
			border-radius: 20px;
			width: 90%;
			height: 40px;
			padding-top: 5px;
			padding-left: 5px;
			padding-right: 5px;
		}

		div.range-selected {
			float: left;
			width: 50%;
			height: 35px;
			background: green;
			border-bottom-left-radius:  20px;
			border-top-left-radius:  20px;
		}

		div.range-notselected {
			float: left;
			width: 50%;
			height: 35px;
			background: red;
			border-bottom-right-radius:  20px;
			border-top-right-radius:  20px;
		}
	</style>
</head>
<body>
	<canvas id="a" class="range-control" height="45"></canvas>
	<div class="range-hold">
		<div class="range-selected"></div>
		<div class="range-notselected"></div>
	</div>
	<span id="selected"></span>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script>
		SELECTION = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"]

		function SORT(a,b) {
		    return a - b;
		}

		function clearCanvas() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}

		function findAvalibaleIndex() {
			if (selected_index - 4 <= 0) {
				a = (4 - selected_index) * gap + gap
			}
			else {
				a = 0
			}
			avaliable_index = new Set();
			viewing = []
			for (i=selected_index - 1,e=0;i>=0;i--,e++) {
				avaliable_index.add((i * gap) + a)

				viewing.push(i)
				if (e == 3) {
					break
				}
			}
			for (i=selected_index,e=0;i<SELECTION.length;i++,e++) {
				avaliable_index.add((i - selected_index + 5) * gap)
				viewing.push(i)

				if (e == 4) {
					break
				}
			}
			avaliable_index = Array.from(avaliable_index).sort(SORT)
			viewing.sort(SORT)
		}

		function drawScale() {
			$.each(avaliable_index, function (_, i) {
				ctx.beginPath();
				ctx.fillRect(i - 2, 0, 4, 40);
				ctx.fill();
			})
		}

		function drawBar() {
			clearCanvas();
			drawScale();
			$.each(avaliable_index, function (e, i) {
				if (Math.abs(pointx - i) <= gap / 2) {
					pointx = i

					ctx.beginPath();
					ctx.arc(pointx, 22, BUTTONRADIUS / 2, 0, 2*Math.PI);
					ctx.fill();
					selected.style.width = pointx - 5 + "px";
					notselected.style.width = canvas.width - (pointx + 9) + "px";

					if (pointx%1 != 0) {
						pointx = Math.floor(pointx / 1) + 1
					}

					// selected_index = Math.floor(i / gap) - Math.floor(avaliable_index[0] / gap)
					// console.log(selected_index)
					selected_index = viewing[e]
					console.log(selected_index)
					// console.log(selected_index)
					$("#selected")[0].innerHTML = SELECTION[selected_index]
					return false;
				}
			})
		}

		$(document).ready(function () {
			BUTTONRADIUS = 30
			
			canvas = $("#a")[0];
			canvas.width = $(document).width() * 0.9;
			ctx = canvas.getContext("2d");
			dragging = false;
			selected = $(".range-selected")[0]
			notselected = $(".range-notselected")[0]	
			gap = canvas.width / 10;
			pointx = gap * 5;
			selected_index = 1;
			avaliable_index = []
			viewing = []

			findAvalibaleIndex();
			drawScale();
			ctx.beginPath();
			ctx.arc(canvas.width / 2, 22, BUTTONRADIUS / 2, 0, 2*Math.PI);
			ctx.fill();

			document.addEventListener('mousedown', function (e) {
				pointx = e.x;
				if (pointx > BUTTONRADIUS && pointx < canvas.width - BUTTONRADIUS / 2) {
					if (e.y < canvas.height) {
						drawBar();
						dragging = true;
					}
				}
			})
			
			document.addEventListener('mousemove', function (e) {
				if (dragging) {
					pointx = e.x;
					if (pointx > BUTTONRADIUS && pointx < canvas.width - BUTTONRADIUS / 2) {
						drawBar();
					}
				}
			})
			
			document.addEventListener('mouseup', function (e) {
				if (dragging) {
					dragging = false;
					pointx = e.x;
					gap = canvas.width / 10;
					
					clearCanvas();
					$.each(avaliable_index, function (_, i) {
						if (Math.abs(pointx - i) <= gap / 2) {
							pointx = gap * 5

							ctx.beginPath();
							ctx.arc(pointx, 22, BUTTONRADIUS / 2, 0, 2*Math.PI);
							ctx.fill();
							selected.style.width = pointx - 5 + "px";
							notselected.style.width = canvas.width - (pointx + 9) + "px";

							if (pointx%1 != 0) {
								pointx = Math.floor(i / 1) + 1
							}
							selected_index = Math.floor(i / gap) - Math.floor(avaliable_index[0] / gap)
							selected_index = viewing[selected_index]
							$("#selected")[0].innerHTML = SELECTION[selected_index]
							return false;
						}
					})
					
					findAvalibaleIndex();
					drawScale();
				}
			})
		})
	</script>
</body>
</html>