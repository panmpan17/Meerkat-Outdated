{% extends "base.html" %}
{% block title %}Admin 老師管理{% endblock %}
{% block css %}
<link rel="stylesheet" href="/html/css/editor.css">
<link rel="stylesheet" href="/html/css/checklist.css">
<style>
	.container {
		display: flex;
	}

	.container article {
		padding: 15px;
		cursor: pointer;
		text-align: left;
	}

	.container article:hover {
		background: rgba(150, 150, 150);
		color: white;
	}

	.container ul {
		padding: 0;
	}

	.container li {
		list-style: none;
		color: black;
		font-weight: 400;
	}

	.container article:hover li:not(:hover) {
		color: white;
	}

	.container li:hover {
		background: white;
		color: black;
	}
</style>
{% endblock %}
{% block content %}
<main>
	<br><br>
	<a href="/admin/" style="padding-left: 14%"><button class="btn btn-orange">管理主頁</button></a>
	<br><br>
	<div id="teacherinfos" class="container"></div>
	<br><br><br><br><br>
</main>
{% endblock %}
{% block bcontent %}
{% endblock %}
{% block script %}
<script type="text/javascript">
	classrooms = {}

	function toggle_classroomlist (article_ele) {
		var clsr_list_ele = article_ele.children[2];
		article_ele.classList.toggle("expend");
		if (article_ele.classList.contains("expend")) {
			$.each(classrooms[article_ele.id], function (i, classroom) {
				li_ele = $("<li></li>")[0]
				li_ele.id = classroom["id"]
				li_ele.innerHTML = classroom["name"]

				clsr_list_ele.append(li_ele)
			})
		}
		else {
			clsr_list_ele.innerHTML = "";
		}
	}

	$.ajax({
		url: host + "teacher/",
		data: {"key": getCookie("key")},
		success: function(msg) {
			console.log(msg);
			$.each(msg["teacherinfos"], function (_, teacher) {
				if (classrooms[teacher["id"]] == undefined) {
					classrooms[teacher["id"]] = []

					article = $("<article>")[0]
					article.append($("<h3>" + teacher["name"] + "</h3>")[0]);
					article.append($("<p>" + teacher["phone"] + "</p>")[0]);
					article.append($(`<ul></ul>`)[0]);
					article.id = teacher["id"]

					article.addEventListener("click", function (e) {
						if (e.target.tagName == "LI") {
							console.log("popup");
							return;
						}
						else if (e.target.tagName != "ARTICLE") {
							article_tag = e.target.parentNode
						}
						else {
							article_tag = e.target
						}

						toggle_classroomlist(article_tag);
					});

					$("#teacherinfos")[0].append(article);
				}

				classrooms[teacher["id"]].push({
					"id": teacher["clsrid"],
					"name": teacher["clsrname"],
				})
			})
		}
	});
</script>
{% endblock %}